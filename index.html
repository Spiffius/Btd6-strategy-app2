<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BTD6 Hard Mode Strategy Picker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-elevated: #0f172a;
      --accent: #22c55e;
      --accent-soft: #15803d;
      --accent-muted: #4ade80;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2937;
      --chip-bg: #111827;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      padding: 1rem;
    }

    .card {
      background: linear-gradient(145deg, #020617 0, #020617 40%, #020617 100%);
      border-radius: 1rem;
      border: 1px solid var(--border-subtle);
      padding: 1rem 1.25rem 1.25rem;
      box-shadow: 0 18px 35px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(14px);
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    h1 span.logo-dot {
      width: 0.65rem;
      height: 0.65rem;
      border-radius: 999px;
      background: conic-gradient(
        from 160deg,
        #22c55e,
        #0ea5e9,
        #a855f7,
        #22c55e
      );
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.7);
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 1rem;
    }

    @media (max-width: 860px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      margin: 0.8rem 0 0.4rem;
    }

    label {
      font-size: 0.88rem;
      color: var(--text-muted);
      display: block;
      margin-bottom: 0.25rem;
    }

    select,
    input[type="text"] {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
    }

    select[multiple] {
      min-height: 150px;
    }

    select:focus,
    input:focus {
      border-color: var(--accent-muted);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .pill {
      font-size: 0.78rem;
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: var(--chip-bg);
      color: var(--text-muted);
      cursor: pointer;
      user-select: none;
      transition: background 0.12s ease, color 0.12s ease, border-color 0.12s ease;
    }

    .pill.active {
      background: rgba(34, 197, 94, 0.2);
      border-color: var(--accent);
      color: var(--accent-muted);
    }

    .toggle-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 0.6rem;
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.85rem;
      color: var(--text-muted);
      cursor: pointer;
      user-select: none;
    }

    .toggle input {
      accent-color: var(--accent);
    }

    .actions {
      margin-top: 0.8rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    button.primary {
      border: none;
      border-radius: 999px;
      padding: 0.45rem 1rem;
      font-size: 0.9rem;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent) 0, var(--accent-soft) 100%);
      color: #022c22;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(34, 197, 94, 0.4);
    }

    button.primary:hover {
      filter: brightness(1.05);
    }

    button.secondary {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.7);
      color: var(--text-muted);
      padding: 0.45rem 0.85rem;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .tab-row {
      display: inline-flex;
      border-radius: 999px;
      padding: 0.1rem;
      background: #020617;
      border: 1px solid var(--border-subtle);
      margin-left: auto;
    }

    .tab-btn {
      border-radius: 999px;
      border: none;
      padding: 0.3rem 0.8rem;
      font-size: 0.8rem;
      cursor: pointer;
      background: transparent;
      color: var(--text-muted);
    }

    .tab-btn.active {
      background: rgba(15, 23, 42, 0.9);
      color: var(--accent-muted);
    }

    .badges-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.15rem;
    }

    .badge {
      font-size: 0.7rem;
      padding: 0.1rem 0.45rem;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
    }

    .badge.tier-S {
      border-color: #f97316;
      color: #fed7aa;
    }

    .badge.tier-A {
      border-color: #22c55e;
      color: #bbf7d0;
    }

    .badge.tier-B {
      border-color: #38bdf8;
      color: #bae6fd;
    }

    .strategies-list {
      margin-top: 0.75rem;
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 0.25rem;
    }

    .strategy-card {
      border-radius: 0.9rem;
      border: 1px solid var(--border-subtle);
      background: linear-gradient(135deg, #020617 0, #020617 30%, #020617 100%);
      padding: 0.7rem 0.75rem 0.75rem;
      margin-bottom: 0.6rem;
    }

    .strategy-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
    }

    .strategy-name {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .strategy-heroes {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.15rem;
    }

    .strategy-notes {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.35rem;
    }

    .phase-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.4rem;
      margin-top: 0.5rem;
      font-size: 0.78rem;
    }

    .phase {
      background: rgba(15, 23, 42, 0.85);
      border-radius: 0.6rem;
      padding: 0.35rem 0.4rem;
      border: 1px dashed var(--border-subtle);
    }

    .phase-title {
      font-weight: 600;
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      margin-bottom: 0.18rem;
    }

    ul.compact {
      margin: 0;
      padding-left: 1rem;
      list-style-type: disc;
    }

    ul.compact li {
      margin: 0.04rem 0;
    }

    .empty-state {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 0.75rem;
    }

    .hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.35rem;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="card">
      <header>
        <h1>
          <span class="logo-dot"></span>
          BTD6 Hard Mode Strategy Picker
        </h1>
        <div class="subtitle">
          Filter B–S tier, low-micro strats by hero, map traits, and Hard/Netflix mode.
        </div>
      </header>

      <div class="layout">
        <!-- LEFT: CONTROLS -->
        <div>
          <div class="section-title">Heroes (multi-select)</div>
          <label for="heroSelect">
            Pick one or more heroes you’re open to using. Leave empty for “any”.
          </label>
          <select id="heroSelect" multiple>
            <!-- populated by JS -->
          </select>
          <div class="hint">
            Tip: hero-less strats (e.g. generic Perma Spike) still appear even if you pick specific heroes.
          </div>

          <div class="section-title">Map & Traits</div>
          <label for="mapName">Map name (optional, free text)</label>
          <input id="mapName" type="text" placeholder="e.g. Dark Castle, Logs, Ravine, Tricky Tracks…" />

          <label style="margin-top:0.5rem;">Map traits (optional)</label>
          <div id="mapTraitsRow" class="pill-row">
            <!-- pills via JS -->
          </div>
          <div class="toggle-row">
            <label class="toggle">
              <input id="waterToggle" type="checkbox" />
              Water-heavy map (enables Pirate Lord / Carrier Flagship / water strats)
            </label>
          </div>

          <div class="section-title">Hard / Netflix Mode</div>
          <label for="modeSelect">
            Choose a Hard-tab mode (matches Netflix BTD6; CHIMPS/Impoppable included).
          </label>
          <select id="modeSelect">
            <!-- populated by JS -->
          </select>

          <div class="section-title">Advanced Filters</div>
          <div class="toggle-row">
            <label class="toggle">
              <input id="microToggle" type="checkbox" />
              Include micro-heavy strats (Corvus, Geraldo shop spam, mine stacking, temple sacs…)
            </label>
          </div>

          <div class="actions">
            <button class="primary" id="filterBtn">Suggest strategies</button>
            <button class="secondary" id="resetBtn">Reset filters</button>

            <div class="tab-row">
              <button class="tab-btn active" data-tab="suggested">Top 5 Suggestions</button>
              <button class="tab-btn" data-tab="all">Full Library</button>
            </div>
          </div>
        </div>

        <!-- RIGHT: RESULTS -->
        <div>
          <div class="section-title">
            Strategies
          </div>
          <div id="strategiesList" class="strategies-list"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- DATA -----------------------------------------------------------------

    const HEROES = [
      { id: "none", name: "No specific hero" },
      { id: "quincy", name: "Quincy" },
      { id: "gwendolin", name: "Gwendolin" },
      { id: "striker", name: "Striker Jones" },
      { id: "obin", name: "Obyn Greenfoot" },
      { id: "churchill", name: "Captain Churchill" },
      { id: "benjamin", name: "Benjamin" },
      { id: "ezili", name: "Ezili" },
      { id: "pat", name: "Pat Fusty" },
      { id: "adora", name: "Adora" },
      { id: "brickell", name: "Admiral Brickell" },
      { id: "etienne", name: "Etienne" },
      { id: "sauda", name: "Sauda" },
      { id: "psi", name: "Psi" },
      { id: "geraldo", name: "Geraldo" },
      { id: "jericho", name: "Agent Jericho" },
      { id: "corvus", name: "Corvus" },
      { id: "rosalia", name: "Rosalia" },
      { id: "bonnie", name: "Bonnie" },
      { id: "amelia", name: "Amelia" },
      { id: "zeejay", name: "Zee Jay" },
      { id: "silas", name: "Silas" }
    ];

    const MODES = [
      { id: "any", label: "Any Hard/Netflix mode" },
      { id: "hard-standard", label: "Hard – Standard" },
      { id: "abr", label: "Hard – Alternate Bloons Rounds" },
      { id: "magic-only", label: "Hard – Magic Only" },
      { id: "double-hp-moabs", label: "Hard – Double HP MOABs" },
      { id: "half-cash", label: "Hard – Half Cash" },
      { id: "impoppable", label: "Impoppable" },
      { id: "chimps", label: "CHIMPS" }
    ];

    const MAP_TRAITS = [
      { id: "beginner", label: "Beginner" },
      { id: "intermediate", label: "Intermediate" },
      { id: "advanced", label: "Advanced" },
      { id: "expert", label: "Expert" },
      { id: "short_path", label: "Short / tight path" },
      { id: "long_path", label: "Long looping path" },
      { id: "multi_path", label: "Multiple paths" },
      { id: "los_blocked", label: "Lots of LOS blockers" },
      { id: "limited_placements", label: "Limited placements" },
      { id: "water_heavy", label: "Lots of water" },
      { id: "no_water", label: "No water" }
    ];

    // Tier weight for sorting suggestions
    const TIER_WEIGHT = { S: 3, A: 2, B: 1 };

    // micro: "low" | "medium" | "high"
    // mapTraits: matches MAP_TRAITS ids + "generalist"
    // modes: subset of MODES ids (use "any" for general)
    // needsWater: true => hide if waterToggle is off
    // heroes: list of hero ids that particularly suit the strat (can be empty)

    const STRATEGIES = [
      {
        id: "silas_super_brittle_smfc",
        name: "Silas Super Brittle + Super Monkey Fan Club",
        tier: "S",
        heroes: ["silas"],
        micro: "medium", // timing SMFC but not insane
        needsWater: false,
        mapTraits: ["advanced", "expert", "multi_path", "generalist"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable", "chimps"],
        notes:
          "S-tier late-game combo built around Silas buffing Ice Monkeys and a wall of Super Monkey Fan Club darts. Cheap for its power and very flexible.",
        build: {
          early: [
            "Open with cheap early game: 0-0-2 Dart + 0-2-0 Ninja + basic 2-0-0 farm (in non-CHIMPS).",
            "Place Silas early to start leveling and to get ice buffs rolling.",
            "Add 0-2-3 Ice(s) for slow + shard value where path is dense."
          ],
          mid: [
            "Rush 0-2-5 Super Brittle on a key choke; place it where all main MOAB traffic passes.",
            "Add 0-2-4 Super Monkey (Super Monkey Fan Club) & village 2-3-0 (jungle drums + camo).",
            "Fill in with more 0-2-4/0-2-5 SMFC darts as needed, plus 4-0-2 Alchemist on main group."
          ],
          late: [
            "Add second Super Brittle if map is long or multi-path.",
            "Stack more SMFC darts and consider 2-5-0 Ice (Absolute Zero) for extra control.",
            "On CHIMPS/Impoppable, lean on Silas abilities to freeze dense rounds (95–100)."
          }
        }
      },
      {
        id: "striker_bomb_blitz",
        name: "Striker Jones + Bomb Blitz Core",
        tier: "S",
        heroes: ["striker"],
        micro: "low",
        needsWater: false,
        mapTraits: ["intermediate", "advanced", "expert", "short_path", "multi_path", "generalist"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable", "chimps"],
        notes:
          "Post-buff Bomb Blitz is effectively a cheaper, spammable mini-Sar Bomba; with Striker level 20 resetting the ability it becomes a very safe, consistent black-border strat on anything that isn’t the absolute hardest map.",
        build: {
          early: [
            "Place Striker early so his bomb buffs come online sooner.",
            "Use 0-2-3 Bomb Shooters on key bends for cheap, reliable early damage.",
            "Add 2-0-0 Village for attack speed and lead/black handling coverage."
          ],
          mid: [
            "Rush first 2-0-5 Bomb Blitz on your best central choke point.",
            "Layer extra 0-3-0 and 2-3-0 Bombs around it for stuns and cleanup.",
            "Add 3-0-2 Village (primary mentoring) if running many Bombs."
          ],
          late: [
            "Pick up Striker level 20 before the scariest rounds (98, 99, 100).",
            "Add second Bomb Blitz if map is long or has multiple paths.",
            "On CHIMPS, lean on Bomb Blitz + Stun overlap to trivialize 95–99."
          }
        }
      },
      {
        id: "brickell_pirate_lord",
        name: "Admiral Brickell + Pirate Lord Cleanup",
        tier: "S",
        heroes: ["brickell"],
        micro: "medium",
        needsWater: true,
        mapTraits: ["water_heavy", "advanced", "expert"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable", "chimps"],
        notes:
          "On maps with good water lines, Brickell + Pirate Lord (often with Energizer) becomes an absurdly strong MOAB/DT cleanup and boss-killer. Hard-carries many expert water maps when you have solid early/midgame.",
        build: {
          early: [
            "Place Brickell in water or near water early so her leveling and mines start contributing.",
            "Use cheap early game (Dart + Sub 0-0-2 into 0-2-3) or a basic Wizard/Ninja core.",
            "Add 0-2-4 Buccaneer(s) as midgame MOAB control + income (in non-CHIMPS)."
          ],
          mid: [
            "Rush 0-4-2 Pirate Lord on central water where both hooks see MOAB traffic.",
            "Add 0-5-2 Carrier Flagship or 0-4-2 Destroyers if map length allows.",
            "Energizer (2-5-0 Sub) behind Pirate Lord greatly increases Brickell uptime and hook spam."
          ],
          late: [
            "Layer more Destroyers/Carriers as needed; Pirate Lord handles BAD support and DDTs.",
            "Brickell level 20 + naval buffs let you delete multi-MOAB waves almost on cooldown.",
            "On CHIMPS, backline with 0-2-5 Icicle Impale or 0-2-5 Super Brittle if map supports it."
          }
        }
      },
      {
        id: "perma_spike_cleanup",
        name: "Perma Spike + Stall Cleanup",
        tier: "S",
        heroes: [], // hero-flexible
        micro: "low",
        needsWater: false,
        mapTraits: ["intermediate", "advanced", "expert", "long_path", "generalist"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable"],
        notes:
          "Despite a history of nerfs, Perma Spike remains one of the safest and most consistent black-border cleanups: it both backstops leaks and chunks round 100 on its own when properly stalled. :contentReference[oaicite:7]{index=7}",
        build: {
          early: [
            "Standard low-micro start: Dart/Ninja into 0-0-2 Wizard and a 2-0-0 Village.",
            "If allowed, build a 2-0-0 Farm or two to afford Perma Spike more comfortably.",
            "Add a 0-2-3 Spike Factory near the exit to start building a spike pile."
          ],
          mid: [
            "Upgrade to 0-2-5 Perma Spike at the very end of the track where Bloons exit.",
            "Add stall: 4-0-2 Main MOAB on ‘Last’ or 0-3-2 MOAB Press spam near mid-track.",
            "Consider 3-0-2 Village over the stall group for pierce/speed."
          ],
          late: [
            "On very hard maps, add a second Spike Factory as 2-0-4 middle path for extra blob.",
            "Layer extra stall (0-2-5 Super Brittle or 0-2-5 Icicle Impale) to feed the pile.",
            "For Impoppable, plan the economy so Perma Spike is online by ~80–85."
          }
        }
      },
      {
        id: "archmage_solver",
        name: "Archmage + Bloon Solver (First Strike Flex)",
        tier: "A",
        heroes: ["obin", "ezili", "rosalia"],
        micro: "low",
        needsWater: false,
        mapTraits: ["advanced", "expert", "long_path", "multi_path", "generalist"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable"],
        notes:
          "A ‘pop 3 black border’ workhorse strat: Archmage handles mixed waves, Bloon Solver deals with ceramics, and a First Strike or two patches their round 100 weakness. :contentReference[oaicite:8]{index=8}",
        build: {
          early: [
            "Hero early: Obyn/Ezili/Rosalia depending on preference and map.",
            "Start with 0-0-2 Wizard + 0-2-0 Ninja or 2-0-0 Druid core for early rounds.",
            "Add a Village 0-2-0 covering your main cluster if LOS permits."
          ],
          mid: [
            "Rush 0-0-5 Archmage at a central high-traffic point.",
            "Add 0-4-2 Bloon Solver positioned where ceramics clump hardest.",
            "Support with 2-3-0 Village (jungle drums + camo) and 4-0-2 Alchemist on the main DPS."
          ],
          late: [
            "Add 2-0-5 Sub(s) (First Strike) on water maps for round 100 and high HP MOABs.",
            "Consider 0-2-5 Icicle Impale or 0-2-5 Super Brittle depending on hero synergy.",
            "Fill leftover cash with 0-2-4 Ninjas or 2-0-4 Snipers on strong."
          }
        }
      },
      {
        id: "glaive_lord_core",
        name: "Glaive Lord Anchor + Support",
        tier: "A",
        heroes: ["quincy", "sauda", "psi"],
        micro: "low",
        needsWater: false,
        mapTraits: ["beginner", "intermediate", "advanced", "short_path", "multi_path", "generalist"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable", "chimps"],
        notes:
          "Extremely reliable lane anchor; Glaive Lord’s orbitals and main attack handle one lane while stray bloons and second lanes get sniped by orbitals. Great generalist strat for a huge number of maps. :contentReference[oaicite:9]{index=9}",
        build: {
          early: [
            "Open with hero + 0-2-3 Boomerang on main bend (favours Sauda/Psi starts).",
            "Add a 2-0-0 Village for camo if your hero can’t cover it early.",
            "Pick up 3-0-2 Boomerang as soon as feasible."
          ],
          mid: [
            "Upgrade to 2-0-5 Glaive Lord on the best central intersection / bend.",
            "Add 0-2-4 Ninja and 0-2-3 Wizard for extra midgame support and camo.",
            "Consider 3-0-2 or 0-3-2 Alchemist buff on the Glaive Lord."
          ],
          late: [
            "Add 0-2-5 Icicle Impale or 0-2-5 Super Brittle for high-round MOAB/ceramic control.",
            "On multi-path maps, add a second DPS like 0-2-5 Sky Shredder or 2-0-5 Dartling at the other lane.",
            "In CHIMPS, lean on cheap support (0-3-0 Village, 0-2-2 Alch) rather than farms."
          }
        }
      },
      {
        id: "sky_shredder_core",
        name: "Sky Shredder Core (with Support)",
        tier: "B",
        heroes: ["benjamin", "churchill", "etienne"],
        micro: "low",
        needsWater: false,
        mapTraits: ["intermediate", "advanced", "long_path", "multi_path", "los_blocked"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable"],
        notes:
          "Sky Shredder is expensive but strong, especially once its buffs and support towers are in place. Solid B-tier all-rounder with good cross-map coverage. :contentReference[oaicite:10]{index=10}",
        build: {
          early: [
            "Open with Benjamin (for eco) or Etienne (for early camo) if map allows.",
            "Use 0-2-0 Ninjas and 0-0-2 Wizards to reach midgame safely.",
            "Place a 0-0-3 Ace on a big loop once you can keep it supplied."
          ],
          mid: [
            "Upgrade the Ace into 0-2-5 Sky Shredder over the highest coverage loop.",
            "Add 2-3-0 Village (jungle drums + camo) and 4-0-2 Alchemist to buff it.",
            "Include 0-2-5 Icicle Impale or 0-3-0 Bombs to help with fortified MOABs."
          ],
          late: [
            "On multi-path maps, consider a second Ace as 2-0-4 for additional coverage.",
            "Add 0-2-4 Sub(s) on water maps for First Strike safety vs round 100.",
            "Fill gaps with 0-2-4 Ninjas or 2-0-4 Snipers as cheap supplemental DPS."
          }
        }
      },
      {
        id: "sentry_champion_core",
        name: "Sentry Champion Control",
        tier: "B",
        heroes: ["etienne", "psi", "rosalia"],
        micro: "low",
        needsWater: false,
        mapTraits: ["intermediate", "advanced", "los_blocked", "limited_placements"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable"],
        notes:
          "Sentry Champion is a flexible map control tower that handles weird pathing and LOS issues well; very solid when backed by village + alch and a strong hero.",
        build: {
          early: [
            "Hero + 0-2-0 Engineer near the start for early pin/foam support.",
            "Add 0-2-0 Ninja for reliable popping and lead coverage via hero or 0-0-3 Bomb.",
            "Place Village 0-2-0 to set up future buffs."
          ],
          mid: [
            "Upgrade Engineer to 2-0-5 Sentry Champion in a central, high-LOS area.",
            "Add 4-0-2 Alchemist buff on the Engineer and key support towers.",
            "Use 0-2-3 Glue or 0-3-0 Bombs to help clump bloons into sentry fire."
          ],
          late: [
            "Add 0-2-5 Icicle Impale or 0-0-5 Glue for MOAB/ceramic control.",
            "Pick up 2-3-0 Village for extra range and attack speed.",
            "Supplement with 2-0-4 Snipers or 0-2-4 Ninjas on strong targeting."
          }
        }
      },
      {
        id: "biggest_one_moab_elim",
        name: "Striker + Biggest One & MOAB Eliminator",
        tier: "B",
        heroes: ["striker"],
        micro: "medium",
        needsWater: false,
        mapTraits: ["intermediate", "advanced", "los_blocked", "generalist"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable", "chimps"],
        notes:
          "Classic Striker mortar/bomb combo; general play B-tier with A-tier peak when you lean into micro and ideal map layouts (Moon Landing, etc.). :contentReference[oaicite:11]{index=11}",
        build: {
          early: [
            "Place Striker early on, then 0-2-3 Bombs for reliable early damage.",
            "Add a basic 0-0-2 Wizard or 0-2-0 Ninja for cleanup and camo.",
            "Place 0-0-3 Mortar aiming at a major cluster to get used to targeting."
          ],
          mid: [
            "Upgrade Mortar to 0-2-5 ‘The Biggest One’ (520 path for faster stuns).",
            "Add 0-5-0 MOAB Eliminator near the front on strong targeting.",
            "Use 2-3-0 Village for buffing and to help with camo and attack speed."
          ],
          late: [
            "Micro Biggest One between lanes/chokes if feasible; its radius is forgiving.",
            "Add extra 0-3-0 Bombs or 0-3-2 Glue to keep MOABs stunned in the blast zone.",
            "On CHIMPS, carefully time Striker’s abilities into dense MOAB waves."
          }
        }
      },
      {
        id: "sub_commander_armada",
        name: "Sub Commander Armada",
        tier: "B",
        heroes: ["brickell", "etienne", "benjamin"],
        micro: "low",
        needsWater: true,
        mapTraits: ["water_heavy", "intermediate", "advanced"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable"],
        notes:
          "Sub Commander plus a fleet of support subs is a strong, map-dependent B-tier strat with good coverage on water-heavy tracks. :contentReference[oaicite:12]{index=12}",
        build: {
          early: [
            "Open with 0-0-2 Sub in good water and a cheap hero (Ben/Etienne/Brickell).",
            "Add 0-2-3 Sub(s) for airburst popping and early defense.",
            "Place Village 0-2-0 if land coverage allows for camo/attack speed."
          ],
          mid: [
            "Upgrade primary Sub to 0-2-5 Sub Commander.",
            "Add 0-2-4 and 2-0-4 Subs around it for stacked DPS and cleanup.",
            "On some maps, include Brickell for naval buffs and mine support."
          ],
          late: [
            "Add 2-0-5 Bloontonium Reactor for camo + support if water path allows.",
            "Include 2-0-5 Sub(s) (First Strike) for round 100.",
            "Supplement with 0-2-5 Ice or 0-2-5 Super Brittle if map has tight chokes."
          }
        }
      },
      {
        id: "etienne_moab_domination",
        name: "Etienne + MOAB Domination",
        tier: "B",
        heroes: ["etienne", "obin", "silas"],
        micro: "medium",
        needsWater: false,
        mapTraits: ["advanced", "expert", "short_path", "multi_path"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable"],
        notes:
          "Overclocked MOAB Domination on maps with ≤3 lanes is brutally strong; the main weakness is the tricky save-up and falloff on very complex tracks. :contentReference[oaicite:13]{index=13}",
        build: {
          early: [
            "Hero early (Etienne or Obyn) to support the save-up and provide camo.",
            "Use 0-2-0 Ninjas and 0-0-2 Wizards to reach midgame safely.",
            "Add 2-0-0 Village for discounts and camo coverage."
          ],
          mid: [
            "Get an Engineer and rush 0-2-5 Overclock.",
            "Save for 2-0-5 MOAB Domination on a main lane; rely on early core to bridge.",
            "Once online, keep MOAB Domination constantly attacking the most critical lane."
          ],
          late: [
            "On multi-path maps, add a second strong MOAB DPS (Glaive Lord / Sky Shredder) for off-lanes.",
            "Keep Overclock on MOAB Dom as much as possible during 90+.",
            "Add 0-2-5 Super Brittle or 0-2-5 Icicle Impale to amplify pierce and control."
          }
        }
      },
      {
        id: "rosalia_apache_prime",
        name: "Rosalia + Apache Prime",
        tier: "B",
        heroes: ["rosalia"],
        micro: "low",
        needsWater: false,
        mapTraits: ["beginner", "intermediate", "long_path", "generalist"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable"],
        notes:
          "Rosalia’s discounts make Apache Prime far easier to afford for black borders; peak is lower than other S/A strats but very comfy on many single-lane maps. :contentReference[oaicite:14]{index=14}",
        build: {
          early: [
            "Place Rosalia early so her discounts kick in sooner.",
            "Use Dart + Heli 0-0-2 or Ninja/Wizard core for early defense.",
            "Switch Heli to lock-in targeting on a good long path segment."
          ],
          mid: [
            "Rush 2-0-5 Apache Prime using Rosalia’s tier discounts.",
            "Add 2-3-0 Village and 4-0-2 Alchemist for buffs.",
            "Keep Apache on ‘Follow Mouse’ or a good locked line depending on map."
          ],
          late: [
            "Add 0-2-5 Icicle Impale or 0-0-5 Glue for MOAB/ceramic control.",
            "For ABR, supplement with 0-2-4 Ninjas or 2-0-4 Snipers for DDT security.",
            "Use leftover cash on more support (Spike Factory or extra Helis)."
          }
        }
      },
      {
        id: "pod_apache_prime",
        name: "Prince of Darkness + Apache Prime ‘No-Skill’",
        tier: "B",
        heroes: ["obin", "ezili"],
        micro: "medium",
        needsWater: false,
        mapTraits: ["intermediate", "advanced", "long_path"],
        modes: ["hard-standard", "abr", "impoppable"],
        notes:
          "POd + Apache Prime is described as a very easy, low-skill B-tier strat that just works if placed correctly, especially on moderate maps. :contentReference[oaicite:15]{index=15}",
        build: {
          early: [
            "Hero early (Obyn/Ezili), then standard Wizard 0-0-2 start.",
            "Head into 0-2-0 Ninja and 2-0-0 Wizard to keep things stable.",
            "Lock the early Heli on a long line if you’re planning ahead."
          ],
          mid: [
            "Rush 0-0-5 Prince of Darkness near the track start so graveyard fills well.",
            "Then rush 2-0-5 Apache Prime on a long mid-section.",
            "Ensure POd always has bloons entering in its graveyard radius."
          ],
          late: [
            "If POd graveyard is underused, micromanage Apache Prime off-screen slightly.",
            "Add 0-2-5 Icicle Impale or 0-0-5 Glue for ceramic/fortified control.",
            "For trickier maps, extra 0-2-4 Ninjas or 2-0-4 Snipers help cover leaks."
          }
        }
      },
      {
        id: "spectre_impale",
        name: "Spectre + Icicle Impale",
        tier: "B",
        heroes: ["rosalia", "obin"],
        micro: "low",
        needsWater: false,
        mapTraits: ["intermediate", "advanced", "multi_path", "long_path"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable"],
        notes:
          "Pairing Spectre with Icicle Impale smooths out Spectre’s weaknesses and plays similarly to Solver/Impale or Glaive Lord/Impale. Rated low B-tier but fun and consistent on the right maps. :contentReference[oaicite:16]{index=16}",
        build: {
          early: [
            "Hero early (Rosalia/Obyn) and a 0-0-2 Ace for early coverage.",
            "Use Ninja/Wizard core to carry you to Spectre timing.",
            "Place Ace on the biggest loop for best coverage."
          ],
          mid: [
            "Upgrade Ace to 0-2-4 Spectre once eco allows.",
            "Add 0-2-5 Icicle Impale on a strong choke near the back half of the track.",
            "Support with Village 2-3-0 for buffs and camo."
          ],
          late: [
            "Stack more Aces (0-2-4) or add a secondary DPS like Glaive Lord.",
            "Use leftover cash on stall (0-3-0 Bombs or 0-3-2 Glue).",
            "Fine-tune Spectre’s flight path by adjusting placement or track shape."
          }
        }
      },
      {
        id: "geraldo_fire_druids",
        name: "Geraldo + Jerry Fire Druids",
        tier: "B",
        heroes: ["geraldo"],
        micro: "medium",
        needsWater: false,
        mapTraits: ["advanced", "expert", "short_path", "multi_path"],
        modes: ["hard-standard", "abr", "impoppable"],
        notes:
          "Druid spam powered up by Geraldo’s Jerry Fire and support like Glue Storm; rated a solid B-tier in the discussion, stronger than the Shinobi setup but more setup-intensive. :contentReference[oaicite:17]{index=17}",
        build: {
          early: [
            "Place Geraldo early to start stocking items and experience.",
            "Start with 0-1-0 Druids and standard cheap towers (Dart/Ninja).",
            "Use Geraldo’s early items (blades, jar) to bridge tricky rounds."
          ],
          mid: [
            "Scale into multiple 0-1-5 Poplust Druids with 2-0-0 Village support.",
            "Use Jerry Fire and Glue Storm to amp Druid damage on key rounds.",
            "Add 4-0-2 Alchemist to buff the highest-impact Druids."
          ],
          late: [
            "On higher rounds, keep Jerry Fire uptime high on the biggest Druid cluster.",
            "Add a hard CC/cleanup piece (0-2-5 Icicle Impale, 0-0-5 Glue, or Perma Spike).",
            "Use Geraldo’s late-game items (genie, paragon totems if applicable) as needed."
          }
        }
      },

      // --- MICRO-HEAVY OPTIONS (behind toggle) -------------------------------

      {
        id: "corvus_micro_spam",
        name: "Corvus Spell Cycling + High-DPS Core",
        tier: "S",
        heroes: ["corvus"],
        micro: "high",
        needsWater: false,
        mapTraits: ["advanced", "expert", "short_path", "multi_path"],
        modes: ["hard-standard", "abr", "double-hp-moabs", "impoppable", "chimps"],
        notes:
          "Extremely strong but very micro-heavy: relies on precise spell cycling and positioning. Hidden by default unless you enable micro-heavy strats.",
        build: {
          early: [
            "Place Corvus ASAP so spellbook and XP ramp up early.",
            "Use cheap Dart/Ninja/Wizard core while you learn early spell usage.",
            "Prioritize eco (farms) where allowed; Corvus loves money."
          ],
          mid: [
            "Stack a strong DPS core (e.g., 0-2-5 Super Brittle + SMFC or Glaive Lord).",
            "Cycle Corvus spells aggressively into MOAB-heavy rounds.",
            "Use spellbook to patch weak camo/lead/ceramic niches."
          ],
          late: [
            "Maintain near-constant spell uptime on dense rounds (90+).",
            "Add heavy stall (Icicle Impale, Glue) to give spells more time to work.",
            "Use remaining cash to overbuild farms or support towers depending on mode."
          }
        }
      },
      {
        id: "geraldo_savatar",
        name: "Geraldo Paragon / Savatar Sac Strats",
        tier: "B",
        heroes: ["geraldo"],
        micro: "high",
        needsWater: false,
        mapTraits: ["advanced", "expert"],
        modes: ["hard-standard", "impoppable"],
        notes:
          "Geraldo paragon/temple sac strats demand high APM and careful planning; powerful but not recommended without deliberate micro. Hidden unless micro toggle is on.",
        build: {
          early: [
            "Geraldo early for shop scaling and totem accumulation.",
            "Play standard efficient early game (Dart/Ninja/Wiz).",
            "Start planning temple positions if going for sacrifices."
          ],
          mid: [
            "Collect and place paragon totems in a safe, buffed area.",
            "Build sacrificial towers in the right value ratios (if going temple).",
            "Use Geraldo’s items to cover round spikes during setup."
          ],
          late: [
            "Drop Paragons and/or temple upgrades at ideal timings.",
            "Continue feeding totems where possible for higher degrees.",
            "Mix in standard high-tier supports (Village, Alch, Ice) to patch gaps."
          }
        }
      }
    ];

    // --- STATE & HELPERS -----------------------------------------------------

    let activeTab = "suggested";

    function $(id) {
      return document.getElementById(id);
    }

    function getSelectedHeroes() {
      const sel = $("heroSelect");
      return Array.from(sel.selectedOptions).map(o => o.value).filter(v => v !== "none");
    }

    function getSelectedMapTraits() {
      const active = document.querySelectorAll("#mapTraitsRow .pill.active");
      return Array.from(active).map(p => p.dataset.id);
    }

    function getSelectedMode() {
      return $("modeSelect").value;
    }

    function tierScore(tier) {
      return TIER_WEIGHT[tier] || 0;
    }

    function strategyMatchesFilters(strategy, { heroes, mapTraits, mode, water, includeMicro }) {
      // micro gate
      if (!includeMicro && strategy.micro === "high") return false;
      // water gate
      if (!water && strategy.needsWater) return false;

      // hero filter: if user selected heroes, we keep
      //  - hero-less strats always allowed
      //  - hero-tagged strats only if intersection
      if (heroes.length > 0 && strategy.heroes.length > 0) {
        const hasOverlap = strategy.heroes.some(h => heroes.includes(h));
        if (!hasOverlap) return false;
      }

      // mode filter
      if (mode !== "any") {
        if (!strategy.modes.includes(mode) && !strategy.modes.includes("any")) {
          return false;
        }
      }

      // map trait filter: all selected traits must be compatible
      if (mapTraits.length > 0) {
        const tags = strategy.mapTraits || [];
        const hasGeneralist = tags.includes("generalist");
        const allMatch = mapTraits.every(t => tags.includes(t) || hasGeneralist);
        if (!allMatch) return false;
      }

      return true;
    }

    function buildStrategyCard(strategy) {
      const heroNames =
        strategy.heroes.length === 0
          ? "Hero-flexible"
          : strategy.heroes
              .map(id => HEROES.find(h => h.id === id)?.name || id)
              .join(", ");

      const tierBadge = `<span class="badge tier-${strategy.tier}">Tier ${strategy.tier}</span>`;
      const microLabel =
        strategy.micro === "low"
          ? "Low micro"
          : strategy.micro === "medium"
          ? "Moderate micro"
          : "High micro";

      const modeLabels = strategy.modes
        .map(id => MODES.find(m => m.id === id))
        .filter(Boolean)
        .map(m => m.label.replace("Hard – ", "").replace("Hard-", "Hard "))
        .join(" • ");

      const traitLabels = (strategy.mapTraits || [])
        .filter(t => t !== "generalist")
        .map(id => MAP_TRAITS.find(mt => mt.id === id))
        .filter(Boolean)
        .map(mt => mt.label)
        .join(" • ");

      const phases = ["early", "mid", "late"];

      return `
        <div class="strategy-card">
          <div class="strategy-header">
            <div>
              <div class="strategy-name">${strategy.name}</div>
              <div class="strategy-heroes">Heroes: ${heroNames}</div>
              <div class="badges-row">
                ${tierBadge}
                <span class="badge">${microLabel}</span>
                ${
                  strategy.needsWater
                    ? '<span class="badge">Water-required</span>'
                    : ""
                }
                ${
                  modeLabels
                    ? `<span class="badge">${modeLabels}</span>`
                    : ""
                }
                ${
                  traitLabels
                    ? `<span class="badge">${traitLabels}</span>`
                    : ""
                }
              </div>
            </div>
          </div>
          <div class="strategy-notes">${strategy.notes}</div>
          <div class="phase-row">
            ${phases
              .map(phase => {
                const items = strategy.build?.[phase] || [];
                if (!items.length) return "";
                const title =
                  phase === "early"
                    ? "Early"
                    : phase === "mid"
                    ? "Mid"
                    : "Late";
                const lis = items.map(i => `<li>${i}</li>`).join("");
                return `
                  <div class="phase">
                    <div class="phase-title">${title}</div>
                    <ul class="compact">${lis}</ul>
                  </div>
                `;
              })
              .join("")}
          </div>
        </div>
      `;
    }

    function renderStrategies() {
      const heroes = getSelectedHeroes();
      const mapTraits = getSelectedMapTraits();
      const mode = getSelectedMode();
      const water = $("waterToggle").checked;
      const includeMicro = $("microToggle").checked;

      const filters = { heroes, mapTraits, mode, water, includeMicro };

      let filtered = STRATEGIES.filter(s => strategyMatchesFilters(s, filters));

      // sort by tier, then by name
      filtered.sort((a, b) => {
        const diff = tierScore(b.tier) - tierScore(a.tier);
        if (diff !== 0) return diff;
        return a.name.localeCompare(b.name);
      });

      let toRender = filtered;
      if (activeTab === "suggested") {
        toRender = filtered.slice(0, 5);
      }

      const container = $("strategiesList");
      if (!toRender.length) {
        container.innerHTML = `
          <div class="empty-state">
            No strategies match your filters.
            Try relaxing hero/map constraints or enabling micro-heavy options.
          </div>
        `;
        return;
      }

      container.innerHTML = toRender.map(buildStrategyCard).join("");
    }

    function resetFilters() {
      const heroSel = $("heroSelect");
      Array.from(heroSel.options).forEach(opt => (opt.selected = false));
      $("mapName").value = "";
      document
        .querySelectorAll("#mapTraitsRow .pill")
        .forEach(p => p.classList.remove("active"));
      $("waterToggle").checked = false;
      $("microToggle").checked = false;
      $("modeSelect").value = "any";
      activeTab = "suggested";
      updateTabButtons();
      renderStrategies();
    }

    function updateTabButtons() {
      document
        .querySelectorAll(".tab-btn")
        .forEach(btn =>
          btn.classList.toggle("active", btn.dataset.tab === activeTab)
        );
    }

    // --- INIT ----------------------------------------------------------------

    function initHeroes() {
      const sel = $("heroSelect");
      HEROES.forEach(h => {
        const opt = document.createElement("option");
        opt.value = h.id;
        opt.textContent = h.name;
        sel.appendChild(opt);
      });
    }

    function initModes() {
      const sel = $("modeSelect");
      MODES.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m.id;
        opt.textContent = m.label;
        sel.appendChild(opt);
      });
    }

    function initMapTraits() {
      const row = $("mapTraitsRow");
      MAP_TRAITS.forEach(mt => {
        const span = document.createElement("span");
        span.className = "pill";
        span.textContent = mt.label;
        span.dataset.id = mt.id;
        span.addEventListener("click", () => {
          span.classList.toggle("active");
          renderStrategies();
        });
        row.appendChild(span);
      });
    }

    function initTabs() {
      document.querySelectorAll(".tab-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          activeTab = btn.dataset.tab;
          updateTabButtons();
          renderStrategies();
        });
      });
    }

    function initEvents() {
      $("filterBtn").addEventListener("click", renderStrategies);
      $("resetBtn").addEventListener("click", resetFilters);

      $("heroSelect").addEventListener("change", renderStrategies);
      $("modeSelect").addEventListener("change", renderStrategies);
      $("waterToggle").addEventListener("change", renderStrategies);
      $("microToggle").addEventListener("change", renderStrategies);
      $("mapName").addEventListener("input", () => {
        // Map name itself is informational for you; filters use traits.
        // No re-filter on every keystroke necessary, but cheap enough:
        renderStrategies();
      });
    }

    function init() {
      initHeroes();
      initModes();
      initMapTraits();
      initTabs();
      initEvents();
      renderStrategies();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
