<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BTD6 Strategy Helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }
    body {
      margin: 0;
      padding: 1rem;
      background: radial-gradient(circle at top, #1f2937, #020617);
      min-height: 100vh;
    }
    .app {
      max-width: 1100px;
      margin: 0 auto;
      background: rgba(15,23,42,0.92);
      border-radius: 18px;
      padding: 1.2rem 1.4rem 1.6rem;
      box-shadow: 0 18px 45px rgba(0,0,0,0.6);
      border: 1px solid rgba(148,163,184,0.25);
    }
    h1 {
      margin-top: 0;
      font-size: 1.4rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .badge {
      font-size: 0.7rem;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      background: rgba(56,189,248,0.1);
      border: 1px solid rgba(56,189,248,0.5);
      color: #7dd3fc;
    }
    .subtitle {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 1rem;
    }
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 1rem;
    }
    @media (max-width: 800px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }
    .card {
      background: rgba(15,23,42,0.96);
      border-radius: 14px;
      padding: 0.75rem 0.9rem 0.9rem;
      border: 1px solid rgba(55,65,81,0.9);
    }
    .card h2 {
      font-size: 0.95rem;
      margin: 0 0 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }
    .card h3 {
      font-size: 0.85rem;
      margin: 0.4rem 0 0.35rem;
    }
    label {
      font-size: 0.8rem;
      color: #e5e7eb;
    }
    select, button {
      width: 100%;
      padding: 0.4rem 0.5rem;
      border-radius: 8px;
      border: 1px solid rgba(75,85,99,0.9);
      background: #020617;
      color: #e5e7eb;
      font-size: 0.8rem;
    }
    select:focus, button:focus {
      outline: 2px solid #38bdf8;
      outline-offset: 2px;
    }
    button {
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      font-size: 0.8rem;
      margin-top: 0.4rem;
      border: none;
      background: linear-gradient(135deg,#22c55e,#16a34a);
      box-shadow: 0 8px 18px rgba(34,197,94,0.35);
    }
    button:hover {
      filter: brightness(1.05);
    }
    .section {
      margin-bottom: 0.6rem;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.2rem;
    }
    .pill {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.2rem 0.45rem;
      border-radius: 999px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.95);
      font-size: 0.75rem;
      cursor: pointer;
      user-select: none;
    }
    .pill input {
      margin: 0;
    }
    .pill-label {
      font-size: 0.75rem;
    }
    .hero-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(120px,1fr));
      gap: 0.3rem;
      margin-top: 0.25rem;
    }
    .hero-pill {
      display: flex;
      align-items: center;
      gap: 0.28rem;
      padding: 0.2rem 0.45rem;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      font-size: 0.75rem;
      cursor: pointer;
    }
    .hero-pill input {
      margin: 0;
    }
    .hint {
      font-size: 0.7rem;
      color: #9ca3af;
      margin-top: 0.25rem;
    }
    .results {
      margin-top: 0.7rem;
      display: grid;
      grid-template-columns: minmax(0,1fr);
      gap: 0.55rem;
    }
    .strategy-card {
      border-radius: 12px;
      border: 1px solid rgba(55,65,81,0.9);
      background: radial-gradient(circle at top left,rgba(30,64,175,0.3),rgba(15,23,42,0.98));
      padding: 0.6rem 0.7rem 0.7rem;
    }
    .strategy-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.2rem;
    }
    .strategy-name {
      font-size: 0.9rem;
      font-weight: 600;
    }
    .tier-pill {
      font-size: 0.7rem;
      padding: 0.1rem 0.35rem;
      border-radius: 999px;
      border: 1px solid rgba(250,250,250,0.3);
    }
    .tier-S { background: rgba(34,197,94,0.12); color: #bbf7d0; border-color: rgba(34,197,94,0.7); }
    .tier-A { background: rgba(59,130,246,0.12); color: #bfdbfe; border-color: rgba(59,130,246,0.7); }
    .tier-B { background: rgba(249,115,22,0.12); color: #fed7aa; border-color: rgba(249,115,22,0.7); }
    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      margin: 0.25rem 0;
    }
    .tag {
      font-size: 0.65rem;
      padding: 0.08rem 0.35rem;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(75,85,99,0.9);
      color: #9ca3af;
    }
    .section-title {
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: 0.35rem;
      margin-bottom: 0.1rem;
    }
    ul {
      margin: 0.1rem 0 0.25rem 1.1rem;
      padding: 0;
      font-size: 0.74rem;
    }
    li {
      margin-bottom: 0.1rem;
    }
    .notes {
      font-size: 0.7rem;
      color: #9ca3af;
      margin-top: 0.15rem;
    }
    .no-results {
      font-size: 0.8rem;
      color: #f97373;
    }
    .map-info {
      margin-top: 0.4rem;
      padding: 0.4rem 0.55rem;
      font-size: 0.75rem;
      border-radius: 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      color: #d1d5db;
    }
    .map-info-title {
      font-weight: 600;
      margin-bottom: 0.15rem;
      font-size: 0.78rem;
    }
    .map-info-tags {
      margin-top: 0.15rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }
    .map-info-tag {
      font-size: 0.65rem;
      padding: 0.06rem 0.3rem;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(75,85,99,0.9);
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>
      BTD6 Strategy Helper
      <span class="badge">v52-ish meta • offline HTML</span>
    </h1>
    <div class="subtitle">
      Pick hero(s), map, hard mode, and map quirks. I’ll suggest up to five reasonably strong,
      low-micro strategies. Toggle in the spicy stuff if you want Corvus/Gerald/VTSG nonsense.
    </div>

    <div class="layout">
      <!-- LEFT: Filters -->
      <div class="card">
        <h2>
          Setup
          <span style="font-size:0.7rem;color:#9ca3af;">Filters are soft – they bias, not hard-lock.</span>
        </h2>

        <div class="section">
          <h3>Hero selection</h3>
          <div class="hero-grid">
            <!-- Leave all unchecked to allow any hero -->
            <label class="hero-pill">
              <input type="checkbox" value="Quincy" class="hero-checkbox" /> Quincy
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Gwendolin" class="hero-checkbox" /> Gwendolin
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Obyn" class="hero-checkbox" /> Obyn
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Sauda" class="hero-checkbox" /> Sauda
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Etienne" class="hero-checkbox" /> Etienne
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Psi" class="hero-checkbox" /> Psi
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Adora" class="hero-checkbox" /> Adora
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Benjamin" class="hero-checkbox" /> Benjamin
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Admiral Brickell" class="hero-checkbox" /> Admiral Brickell
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Geraldo" class="hero-checkbox" /> Geraldo
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Corvus" class="hero-checkbox" /> Corvus
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Pat Fusty" class="hero-checkbox" /> Pat Fusty
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Striker Jones" class="hero-checkbox" /> Striker Jones
            </label>
            <label class="hero-pill">
              <input type="checkbox" value="Captain Churchill" class="hero-checkbox" /> Churchill
            </label>
          </div>
          <div class="hint">Leave all unchecked if you’re open to any hero.</div>
        </div>

        <div class="section">
          <h3>Map & Mode</h3>
          <label for="mapSelect">Map</label>
          <select id="mapSelect">
            <option value="">Any map</option>
            <!-- Maps are added by JS on load -->
          </select>

          <div id="mapInfoBox" class="map-info">
            <div class="map-info-title">Map info</div>
            <div id="mapInfoText">Select a map to see difficulty and terrain tags, or leave it on “Any map”.</div>
            <div id="mapInfoTags" class="map-info-tags"></div>
          </div>

          <label for="missionSelect" style="margin-top:0.45rem;display:block;">Hard-mode mission</label>
          <select id="missionSelect">
            <option value="Any">Any hard mode</option>
            <option value="Hard Standard">Hard – Standard</option>
            <option value="Alternate Bloons Rounds">Hard – ABR</option>
            <option value="Impoppable">Impoppable</option>
            <option value="CHIMPS">CHIMPS</option>
            <option value="Magic Only">Magic Only</option>
            <option value="Double HP MOABs">Double HP MOABs</option>
            <option value="Half Cash">Half Cash</option>
            <option value="Netflix Special">Quest / Netflix special</option>
          </select>
        </div>

        <div class="section">
          <h3>Map traits (how it actually feels)</h3>
          <div class="pill-row">
            <label class="pill">
              <input type="checkbox" id="waterToggle" />
              <span class="pill-label">Water-heavy</span>
            </label>
            <label class="pill">
              <input type="checkbox" id="multiPathToggle" />
              <span class="pill-label">Multi-path / split lanes</span>
            </label>
            <label class="pill">
              <input type="checkbox" id="losToggle" />
              <span class="pill-label">Limited line of sight</span>
            </label>
            <label class="pill">
              <input type="checkbox" id="shortPathToggle" />
              <span class="pill-label">Short path / punishing leaks</span>
            </label>
            <label class="pill">
              <input type="checkbox" id="netflixToggle" />
              <span class="pill-label">Special / gimmick challenge</span>
            </label>
          </div>
          <div class="hint">
            These are manual “vibes” toggles. Use them when the map is being weird (Geared, Peninsula, Ravine, etc.).
          </div>
        </div>

        <div class="section">
          <h3>Spice level</h3>
          <label class="pill">
            <input type="checkbox" id="microToggle" />
            <span class="pill-label">Allow micro-heavy strategies (Geraldo, Corvus, temple sac, etc.)</span>
          </label>
          <div class="hint">
            Turn this on if you’re happy to ability-spam or babysit Geraldo shops and temple sacrifices.
          </div>
        </div>

        <button type="button" id="recommendBtn">Suggest strategies</button>
      </div>

      <!-- RIGHT: Results -->
      <div class="card">
        <h2>
          Suggested strategies
          <span style="font-size:0.7rem;color:#9ca3af;">Top 5 matches, sorted by tier & fit.</span>
        </h2>
        <div id="results" class="results">
          <div class="no-results">
            Choose some options on the left and hit “Suggest strategies” to populate this.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Base map list (names + difficulty, as before) ---
    const MAPS = [
      // Beginner
      { name: "Monkey Meadow", difficulty: "Beginner" },
      { name: "In The Loop", difficulty: "Beginner" },
      { name: "Middle of the Road", difficulty: "Beginner" },
      { name: "Tree Stump", difficulty: "Beginner" },
      { name: "Town Center", difficulty: "Beginner" },
      { name: "One Two Tree", difficulty: "Beginner" },
      { name: "Scrapyard", difficulty: "Beginner" },
      { name: "The Cabin", difficulty: "Beginner" },
      { name: "Resort", difficulty: "Beginner" },
      { name: "Tinkerton", difficulty: "Beginner" },
      { name: "Skates", difficulty: "Beginner" },
      { name: "Lotus Island", difficulty: "Beginner" },
      { name: "Candy Falls", difficulty: "Beginner" },
      { name: "Winter Park", difficulty: "Beginner" },
      { name: "Carved", difficulty: "Beginner" },
      { name: "Park Path", difficulty: "Beginner" },
      { name: "Alpine Run", difficulty: "Beginner" },
      { name: "Frozen Over", difficulty: "Beginner" },
      { name: "Cubism", difficulty: "Beginner" },
      { name: "Four Circles", difficulty: "Beginner" },
      { name: "Hedge", difficulty: "Beginner" },
      { name: "End of the Road", difficulty: "Beginner" },
      { name: "Logs", difficulty: "Beginner" },
      { name: "Spa Pits", difficulty: "Beginner" },
      { name: "Three Mines 'Round", difficulty: "Beginner" },

      // Intermediate
      { name: "Lost Crevasse", difficulty: "Intermediate" },
      { name: "Sulfur Springs", difficulty: "Intermediate" },
      { name: "Luminous Cove", difficulty: "Intermediate" },
      { name: "Water Park", difficulty: "Intermediate" },
      { name: "Polyphemus", difficulty: "Intermediate" },
      { name: "Covered Garden", difficulty: "Intermediate" },
      { name: "Quarry", difficulty: "Intermediate" },
      { name: "Quiet Street", difficulty: "Intermediate" },
      { name: "Bloonarius Prime", difficulty: "Intermediate" },
      { name: "Balance", difficulty: "Intermediate" },
      { name: "Encrypted", difficulty: "Intermediate" },
      { name: "Bazaar", difficulty: "Intermediate" },
      { name: "Adora's Temple", difficulty: "Intermediate" },
      { name: "Spring Spring", difficulty: "Intermediate" },
      { name: "KartsNDarts", difficulty: "Intermediate" },
      { name: "Moon Landing", difficulty: "Intermediate" },
      { name: "Haunted", difficulty: "Intermediate" },
      { name: "Downstream", difficulty: "Intermediate" },
      { name: "Firing Range", difficulty: "Intermediate" },
      { name: "Cracked", difficulty: "Intermediate" },
      { name: "Streambed", difficulty: "Intermediate" },
      { name: "Chutes", difficulty: "Intermediate" },
      { name: "Rake", difficulty: "Intermediate" },
      { name: "Spice Islands", difficulty: "Intermediate" },

      // Advanced
      { name: "Sunset Gulch", difficulty: "Advanced" },
      { name: "Enchanted Glade", difficulty: "Advanced" },
      { name: "Last Resort", difficulty: "Advanced" },
      { name: "Ancient Portal", difficulty: "Advanced" },
      { name: "Castle Revenge", difficulty: "Advanced" },
      { name: "Dark Path", difficulty: "Advanced" },
      { name: "Erosion", difficulty: "Advanced" },
      { name: "Midnight Mansion", difficulty: "Advanced" },
      { name: "Sunken Columns", difficulty: "Advanced" },
      { name: "X Factor", difficulty: "Advanced" },
      { name: "Mesa", difficulty: "Advanced" },
      { name: "Geared", difficulty: "Advanced" },
      { name: "Spillway", difficulty: "Advanced" },
      { name: "Cargo", difficulty: "Advanced" },
      { name: "Pat's Pond", difficulty: "Advanced" },
      { name: "Peninsula", difficulty: "Advanced" },
      { name: "High Finance", difficulty: "Advanced" },
      { name: "Another Brick", difficulty: "Advanced" },
      { name: "Off The Coast", difficulty: "Advanced" },
      { name: "Cornfield", difficulty: "Advanced" },
      { name: "Underground", difficulty: "Advanced" },

      // Expert
      { name: "Glacial Trail", difficulty: "Expert" },
      { name: "Dark Dungeons", difficulty: "Expert" },
      { name: "Sanctuary", difficulty: "Expert" },
      { name: "Ravine", difficulty: "Expert" },
      { name: "Flooded Valley", difficulty: "Expert" },
      { name: "Infernal", difficulty: "Expert" },
      { name: "Bloody Puddles", difficulty: "Expert" },
      { name: "Workshop", difficulty: "Expert" },
      { name: "Quad", difficulty: "Expert" },
      { name: "Dark Castle", difficulty: "Expert" },
      { name: "Muddy Puddles", difficulty: "Expert" },
      { name: "#Ouch", difficulty: "Expert" },

      // Specials
      { name: "Protect The Yacht", difficulty: "Intermediate" },
      { name: "Blons", difficulty: "Expert" }
    ];

    // --- Map terrain metadata (derived from Bloons Wiki + general knowledge) ---
    // This is intentionally partial; maps not listed here will still work, but won't auto-tag.
    const MAP_TRAITS = {
      "Monkey Meadow": {
        water: false,
        multiPath: false,
        los: true,   // trees on corners
        short: false,
        description: "Beginner single-lane map with gentle bends, no water, mild LOS trees in the corners."
      },
      "Logs": {
        water: false,
        multiPath: false,
        los: false,
        short: false,
        description: "Long, looping track with excellent placement space and almost no LOS issues. Very forgiving."
      },
      "Cubism": {
        water: false,
        multiPath: true,
        los: false,
        short: false,
        description: "Four interwoven paths with generous space; feels like multi-lane but still very manageable."
      },
      "Spice Islands": {
        water: true,
        multiPath: true,
        los: false,
        short: false,
        description: "Ships-on-islands map with water all around and split paths that converge near the exit."
      },
      "Off The Coast": {
        water: true,
        multiPath: false,
        los: false,
        short: false,
        description: "Mostly water with a strip of land; boats and subs shine, land space is precious."
      },
      "Flooded Valley": {
        water: true,
        multiPath: true,
        los: true,
        short: true,
        description: "Expert dam map with short, simultaneous lanes, heavy water, limited land, and LOS obstacles."
      },
      "Peninsula": {
        water: true,
        multiPath: true,
        los: true,
        short: true,
        description: "Awkward peninsula layout with split lanes, tight build spots, and a lot of water."
      },
      "Pat's Pond": {
        water: true,
        multiPath: false,
        los: false,
        short: false,
        description: "Central pond surrounded by path; excellent for Brickell/Pat and water-centric strategies."
      },
      "Geared": {
        water: false,
        multiPath: false,
        los: true,
        short: true,
        description: "Rotating gear track; constantly shifts tower coverage, short effective path, lots of jank."
      },
      "Workshop": {
        water: false,
        multiPath: true,
        los: true,
        short: true,
        description: "Multiple small lanes and heavy LOS blockers; space and sight-lines are both awkward."
      },
      "Bloody Puddles": {
        water: false,
        multiPath: true,
        los: false,
        short: true,
        description: "Five brutal short lanes, lots of entry points and very little reaction time."
      },
      "Muddy Puddles": {
        water: false,
        multiPath: true,
        los: false,
        short: true,
        description: "Four lanes with tight entry timings; similar idea to Bloody Puddles but slightly tamer."
      },
      "Ravine": {
        water: false,
        multiPath: true,
        los: true,
        short: true,
        description: "Deep ravine with split paths and heavy LOS issues; DDTs are notoriously painful here."
      },
      "Dark Castle": {
        water: false,
        multiPath: true,
        los: true,
        short: true,
        description: "Tight expert map with multiple lanes, sharp turns, and castle walls blocking LOS."
      },
      "Infernal": {
        water: false,
        multiPath: true,
        los: true,
        short: true,
        description: "Two small platforms over lava with portals; nasty LOS and limited placement."
      },
      "Dark Dungeons": {
        water: false,
        multiPath: true,
        los: true,
        short: true,
        description: "Labyrinthine dungeon with extreme LOS issues and pathing — Psi loves it, many others hate it."
      },
      "Cornfield": {
        water: false,
        multiPath: false,
        los: true,
        short: false,
        description: "Huge map but almost all of it is blocked by corn until you pay to clear it."
      },
      "Underground": {
        water: false,
        multiPath: true,
        los: true,
        short: false,
        description: "Above/below-ground paths with LOS shenanigans and tricky coverage."
      },
      "Encrypted": {
        water: false,
        multiPath: false,
        los: true,
        short: false,
        description: "Central ruins with strong LOS blockers; good for magic and global-range towers."
      },
      "Bazaar": {
        water: true,
        multiPath: true,
        los: true,
        short: true,
        description: "Split lanes passing through market stalls; water spots are useful but LOS is messy."
      },
      "Balance": {
        water: false,
        multiPath: true,
        los: false,
        short: false,
        description: "Symmetrical twin lanes, good for testing setups; no major LOS issues."
      },
      "Haunted": {
        water: false,
        multiPath: true,
        los: true,
        short: false,
        description: "Haunted house in the middle, with paths weaving around and through LOS blockers."
      },
      "Downstream": {
        water: true,
        multiPath: false,
        los: false,
        short: false,
        description: "River map with a clear land bridge and plenty of water for boats/subs."
      },
      "Lotus Island": {
        water: true,
        multiPath: false,
        los: true,
        short: false,
        description: "Island map with lotus pads and some LOS quirks; good water access."
      },
      "Water Park": {
        water: true,
        multiPath: true,
        los: false,
        short: false,
        description: "Amusement-park style with water slides and multiple watery lanes."
      },
      "Glacial Trail": {
        water: true,
        multiPath: true,
        los: true,
        short: true,
        description: "Icy, slippery-feeling expert map with split paths, ice LOS, and water sections."
      },
      "Spa Pits": {
        water: true,
        multiPath: false,
        los: false,
        short: false,
        description: "Beginner map with hot springs; simple path but lots of water around it."
      },
      "Three Mines 'Round": {
        water: false,
        multiPath: true,
        los: true,
        short: false,
        description: "Beginner-level but with rotating mine carts and some LOS/spacing quirks."
      }
    };

    // --- Strategy data (unchanged from previous version) ---
    const STRATEGIES = [
      {
        id: "obyn_druid_wall_chimps",
        name: "Obyn Druid Wall (Standard CHIMPS)",
        tier: "S",
        heroes: ["Obyn"],
        missions: ["CHIMPS", "Impoppable", "Hard Standard", "Alternate Bloons Rounds", "Any Hard"],
        mapDifficulties: ["Beginner", "Intermediate", "Advanced"],
        mapTraits: ["standard", "multi-path", "limited-los-ok"],
        microHeavy: false,
        coreTowers: [
          "5–8x Spirit of the Forest Druids (0-2-5 / 0-3-2 mix)",
          "Alchemist (4-0-2) buffing main Druids",
          "Prince of Darkness (0-0-5) or Archmage (0-2-5) for clean-up"
        ],
        supportTowers: [
          "Village (2-3-0) → (2-5-0) for jungle drums + primary/ability support",
          "Village (0-2-5) for camo/primary buffs if using primary-damage mix",
          "Optional: Spike Factory (0-2-5) as safety net"
        ],
        order: [
          "Early: Obyn near strong bend, 2–3 2-0-2 Druids",
          "Mid: Add Alch 3-0-0 → 4-0-2, expand to 5+ Druids, get Village 2-2-0",
          "Late: Upgrade main Druid to 0-2-5, add PoD/Archmage, second Village (2-3-0→2-5-0)"
        ],
        notes: "Solid all-rounder for non-extreme maps with decent bends. Weak on ultra short paths or maps with horrific LOS like Dark Dungeons."
      },
      {
        id: "sauda_ninja_alch_abr",
        name: "Sauda Ninja–Alch Core (ABR / High Pressure)",
        tier: "S",
        heroes: ["Sauda"],
        missions: ["Alternate Bloons Rounds", "Impoppable", "Hard Standard", "Any Hard"],
        mapDifficulties: ["Beginner", "Intermediate"],
        mapTraits: ["short-path", "limited-los-ok"],
        microHeavy: false,
        coreTowers: [
          "Hero Sauda centered on main intersection",
          "Ninja (4-0-2) into (5-0-2) if needed",
          "Alchemist (4-0-2) buffing Sauda + Ninja"
        ],
        supportTowers: [
          "Village (2-2-0) → (2-3-0) for jungle drums + camo",
          "Glue Gunner (0-2-4) on strong for MOAB slow",
          "Sniper (0-2-5) for long-range clean-up if LOS allows"
        ],
        order: [
          "Early: Sauda → 2-0-2 Ninja",
          "Mid: Add 3-0-0 → 4-0-2 Alch, then 4-0-2 Ninja",
          "Late: Village 2-2-0, upgrade Ninja to 5-0-2, add Glue 0-2-4 / Sniper as needed"
        ],
        notes: "Shines on short and ABR-biased maps where early pressure is nasty (e.g. Chutes, Rake)."
      },
      {
        id: "etienne_double_sub_water",
        name: "Etienne + Double Sub Commander (Water-heavy carry)",
        tier: "A",
        heroes: ["Etienne"],
        missions: ["Impoppable", "Hard Standard", "Double HP MOABs", "Any Hard"],
        mapDifficulties: ["Intermediate", "Advanced"],
        mapTraits: ["water-heavy", "multi-path"],
        microHeavy: false,
        coreTowers: [
          "2x Submarine (2-0-4) → later one 2-0-5",
          "Alchemist (4-0-2) for sub buffs",
          "Etienne for global camo once leveled"
        ],
        supportTowers: [
          "Village (2-3-0) in water radius if possible",
          "Frag Bomb (2-3-0) or Recursive Cluster (2-0-4) for early rounds",
          "Sniper (0-2-5) / Elite Defender for emergency anti-rush"
        ],
        order: [
          "Early: Bomb 2-3-0 + basic Sub (2-0-0)",
          "Mid: Etienne, second Sub, both to 2-0-4, add Alch 3-0-0 → 4-0-2",
          "Late: Upgrade one Sub to 2-0-5, add Village 2-3-0, extra support as needed"
        ],
        notes: "Excellent on Spice Islands, Off The Coast, Last Resort, Flooded Valley when water is plentiful."
      },
      {
        id: "no_hero_ninja_alch_super",
        name: "No-Hero Ninja–Alch into Super (Generic Hard)",
        tier: "A",
        heroes: [],
        missions: ["Hard Standard", "Alternate Bloons Rounds", "Double HP MOABs", "Any Hard"],
        mapDifficulties: ["Beginner", "Intermediate"],
        mapTraits: ["standard"],
        microHeavy: false,
        coreTowers: [
          "Ninja (4-0-2) as main carry",
          "Alchemist (4-0-2) for buffs",
          "Super Monkey (2-0-3) or (0-2-3) late game"
        ],
        supportTowers: [
          "Village (2-2-0) for range + attack speed",
          "Bomb (2-0-4) or Glue (0-2-4) for MOAB control"
        ],
        order: [
          "Early: 2-0-0 Ninja, then another 2-0-0 or Bomb 2-2-0",
          "Mid: Alch 3-0-0 → 4-0-2, Ninja to 4-0-2",
          "Late: Village 2-2-0, drop Super Monkey and upgrade to 2-0-3"
        ],
        notes: "Deliberately hero-agnostic for Netflix runs where you just want a consistent, low-brain line."
      },
      {
        id: "ben_farms_ninja_alch",
        name: "Benjamin + Farmed Ninja/Alch (Economy-first)",
        tier: "A",
        heroes: ["Benjamin"],
        missions: ["Hard Standard", "Alternate Bloons Rounds", "Double HP MOABs"],
        mapDifficulties: ["Beginner", "Intermediate"],
        mapTraits: ["standard"],
        microHeavy: false,
        coreTowers: [
          "Benjamin for eco boost",
          "Ninja (4-0-2) → (5-0-2)",
          "Alchemist (4-0-2)"
        ],
        supportTowers: [
          "2–4 Banana Farms (2-0-3 → 2-0-4) depending on comfort",
          "Village (2-3-0) for buffs",
          "Glue 0-2-4 or Ice 0-2-4 as needed"
        ],
        order: [
          "Early: Ninja 2-0-0 + basic Dart/Engi support",
          "Round ~5–8: Place Benjamin, start 1–2 Farms",
          "Mid: Alch 4-0-2, Ninja 4-0-2, expand farms",
          "Late: Ninja 5-0-2, Village 2-3-0, extra DPS as cash allows"
        ],
        notes: "Great if you want money for late-game flex, not ideal for CHIMPS/Impoppable."
      },
      {
        id: "brickell_carrier_fleet",
        name: "Brickell + Carrier & Moab-Shred Fleet (Pure Water Fun)",
        tier: "A",
        heroes: ["Admiral Brickell"],
        missions: ["Hard Standard", "Impoppable", "Double HP MOABs", "Any Hard"],
        mapDifficulties: ["Intermediate", "Advanced", "Expert"],
        mapTraits: ["water-heavy"],
        microHeavy: false,
        coreTowers: [
          "Carrier Flagship (2-0-5)",
          "Destroyer (0-2-4) into (0-2-5) if needed",
          "Alchemist (4-0-2) on flagship"
        ],
        supportTowers: [
          "Village (2-3-0) covering water area",
          "Sub (2-0-4) for cross-map targeting",
          "Optional: Sniper 0-2-5 for support"
        ],
        order: [
          "Early: 0-0-2 Boat and 2-0-0 Boat spam",
          "Mid: Brickell → upgrade main boat to 0-2-3 → 0-2-4",
          "Late: Carrier 2-0-5, then Alch 4-0-2 and Village 2-3-0"
        ],
        notes: "Spice Islands, Off The Coast, Flooded Valley, Pat’s Pond, Water Park all love this."
      },
      {
        id: "psi_magic_control",
        name: "Psi Magic Control (LOS / Weird Paths)",
        tier: "A",
        heroes: ["Psi"],
        missions: ["CHIMPS", "Impoppable", "Magic Only", "Any Hard"],
        mapDifficulties: ["Intermediate", "Advanced"],
        mapTraits: ["limited-los-ok", "multi-path"],
        microHeavy: false,
        coreTowers: [
          "Psi for global stuns at high levels",
          "Wizard (0-2-5) Prince of Darkness",
          "Ninja (4-0-2)"
        ],
        supportTowers: [
          "Alchemist (4-0-2) on Ninja",
          "Village (2-2-0) → (2-3-0)",
          "Glue 0-2-4 or Ice 0-2-4 to support control"
        ],
        order: [
          "Early: Cheap Dart/Engi to get through early rounds, then Psi",
          "Mid: 0-2-2 Wizard → 0-2-5 PoD, Ninja 4-0-2",
          "Late: Add Alch, Village, and glue/ice as needed"
        ],
        notes: "Good when LOS really sucks (e.g. Dark Dungeons, Encrypted, Covered Garden), as Psi ignores a lot of it."
      },
      {
        id: "dark_castle_obyn_druid",
        name: "Dark Castle / #Ouch Obyn Druid Variant (No Micro)",
        tier: "S",
        heroes: ["Obyn"],
        missions: ["CHIMPS", "Impoppable"],
        mapDifficulties: ["Expert"],
        mapTraits: ["short-path", "limited-los-ok"],
        microHeavy: false,
        coreTowers: [
          "6–8 Poplust Druids (0-2-4) + 1 Avatar of Wrath (0-2-5)",
          "Alchemist (4-0-2)",
          "Optional: Super Monkey (2-0-3) for extra DPS"
        ],
        supportTowers: [
          "Village (2-3-0) → (2-5-0)",
          "Village (0-2-5) if mixing primary support",
          "Glue 0-2-4 on strong for MOABs"
        ],
        order: [
          "Early: Strong start (Druid 0-1-2 + Obyn at a bend)",
          "Mid: Build to 4+ Poplust, Alch 4-0-2, Village 2-3-0",
          "Late: Avatar of Wrath, more Poplust, second Village or support as needed"
        ],
        notes: "Specifically tuned for brutal Expert maps with tight paths and heavy pressure."
      },
      {
        id: "workshop_etienne_chimps",
        name: "Workshop / Quad Tech – Etienne + Mixed Core",
        tier: "A",
        heroes: ["Etienne"],
        missions: ["CHIMPS", "Impoppable"],
        mapDifficulties: ["Expert"],
        mapTraits: ["multi-path", "limited-los-ok", "short-path"],
        microHeavy: false,
        coreTowers: [
          "Ninja (4-0-2)",
          "Alchemist (4-0-2)",
          "Wizard (0-2-4) into (0-2-5) or (2-0-4)",
          "Etienne for global camo"
        ],
        supportTowers: [
          "Village (2-3-0)",
          "Spike Factory (0-2-5) at exits if space allows"
        ],
        order: [
          "Early: Ninja start + basic support (Dart/Boomer)",
          "Mid: Etienne, Alch 4-0-2, Ninja 4-0-2, Wizard 0-2-4",
          "Late: Village 2-3-0, PoD or 2-0-4 Wizard, optional Spactory"
        ],
        notes: "Aimed at maps like Workshop, Quad, Geared where coverage and path splits are annoying."
      },
      {
        id: "bloody_puddles_sauda_low_micro",
        name: "Bloody Puddles Sauda + Fire & Glue (Low-Micro)",
        tier: "B",
        heroes: ["Sauda"],
        missions: ["Impoppable", "Hard Standard"],
        mapDifficulties: ["Expert"],
        mapTraits: ["multi-path", "short-path"],
        microHeavy: false,
        coreTowers: [
          "Sauda at highest-impact junction",
          "2–3 Wizards (2-0-3) Fireball/Wall of Fire",
          "Glue Gunner (0-2-4)"
        ],
        supportTowers: [
          "Alch 4-0-2 on main Wizard cluster",
          "Village 2-2-0",
          "Later: Ninja 4-0-2 or Sniper 0-2-5"
        ],
        order: [
          "Early: Sauda + basic Wizard 0-2-2",
          "Mid: Add second/third Wizard 2-0-3 + Glue 0-2-4",
          "Late: Alch 4-0-2, Village, then extra DPS"
        ],
        notes: "Not the absolute top meta, but significantly easier to pilot than many sweaty Bloody Puddles runs."
      },
      {
        id: "ravine_psi_anti_ddt",
        name: "Ravine Psi Anti-DDT Plan",
        tier: "A",
        heroes: ["Psi"],
        missions: ["CHIMPS", "Impoppable"],
        mapDifficulties: ["Expert"],
        mapTraits: ["multi-path", "limited-los-ok"],
        microHeavy: false,
        coreTowers: [
          "Psi (high level for DDT control)",
          "Ninja (5-0-2)",
          "Alch (4-0-2)",
          "Village (2-3-0)"
        ],
        supportTowers: [
          "Ice (0-2-4) or (2-0-4) if placement allows",
          "Glue (0-2-4)",
          "Optional: Super 2-0-3"
        ],
        order: [
          "Early: cheap towers to secure until Psi is up",
          "Mid: Ninja 4-0-2 + Alch 4-0-2 + Village",
          "Late: Ninja 5-0-2, Psi levels, control towers (Glue/Ice)"
        ],
        notes: "Designed around surviving DDTs on Ravine without tearing your hair out on targeting micro."
      },
      // Micro-heavy / “toggle-only” fun
      {
        id: "geraldo_vtsg_temple",
        name: "Geraldo VTSG + Temple Sacrifice Playground",
        tier: "S",
        heroes: ["Geraldo"],
        missions: ["CHIMPS", "Impoppable", "Hard Standard", "Any Hard"],
        mapDifficulties: ["Beginner", "Intermediate", "Advanced"],
        mapTraits: ["standard"],
        microHeavy: true,
        coreTowers: [
          "Sun Temple (5-0-0) into True Sun God (5-2-0 / 5-0-2) with full sac categories",
          "Vengeful True Sun God if permissible",
          "Geraldo for totems, traps, and buff items"
        ],
        supportTowers: [
          "Alch 4-0-2",
          "Village 2-5-0",
          "Various sac towers (T5 support, military, magic, primary)"
        ],
        order: [
          "Early: Geraldo + strong early towers (Dart/Ninja/Alch)",
          "Mid: Build sac categories, Sun Temple, Geraldo shop items for buffs",
          "Late: True Sun God, optional VTSG, support buffs"
        ],
        notes: "Incredible power ceiling, but micro-intensive and very planning-heavy. Only appears if you enable the micro toggle."
      },
      {
        id: "corvus_ability_blast",
        name: "Corvus Ritual Burst (High-Micro Camo & Bossing)",
        tier: "A",
        heroes: ["Corvus"],
        missions: ["Hard Standard", "Impoppable", "Netflix Special"],
        mapDifficulties: ["Intermediate", "Advanced"],
        mapTraits: ["short-path", "netflix-quest"],
        microHeavy: true,
        coreTowers: [
          "Corvus with well-timed rituals",
          "Ninja (5-0-2)",
          "Wizard (0-2-5) PoD"
        ],
        supportTowers: [
          "Village (2-3-0)",
          "Alch 4-0-2",
          "Optional Glue/Ice"
        ],
        order: [
          "Early: Stable core (Ninja/Wiz) while Corvus levels",
          "Mid: Start using Corvus rituals on key waves",
          "Late: Upgrade to T5s, aggressively chain abilities"
        ],
        notes: "Fun for special Netflix/Quest style content where ability spam is rewarded; not recommended if you hate timing windows."
      }
    ];

    function getSelectedHeroes() {
      var checkboxes = document.querySelectorAll(".hero-checkbox");
      var heroes = [];
      for (var i = 0; i < checkboxes.length; i++) {
        if (checkboxes[i].checked) {
          heroes.push(checkboxes[i].value);
        }
      }
      return heroes;
    }

    function populateMapSelect() {
      var select = document.getElementById("mapSelect");
      var difficulties = ["Beginner", "Intermediate", "Advanced", "Expert"];
      difficulties.forEach(function (diff) {
        var groupMaps = MAPS.filter(function (m) { return m.difficulty === diff; });
        if (groupMaps.length === 0) return;
        var optGroup = document.createElement("optgroup");
        optGroup.label = diff;
        groupMaps.forEach(function (m) {
          var opt = document.createElement("option");
          opt.value = m.name;
          opt.textContent = m.name;
          optGroup.appendChild(opt);
        });
        select.appendChild(optGroup);
      });

      var specials = MAPS.filter(function (m) {
        return m.name === "Protect The Yacht" || m.name === "Blons";
      });
      if (specials.length > 0) {
        var og = document.createElement("optgroup");
        og.label = "Special / Challenge Editor";
        specials.forEach(function (m) {
          var opt = document.createElement("option");
          opt.value = m.name;
          opt.textContent = m.name;
          og.appendChild(opt);
        });
        select.appendChild(og);
      }
    }

    function updateMapInfo(mapName) {
      var infoBox = document.getElementById("mapInfoBox");
      var textEl = document.getElementById("mapInfoText");
      var tagsEl = document.getElementById("mapInfoTags");

      tagsEl.innerHTML = "";

      if (!mapName) {
        textEl.textContent = "Select a map to see difficulty and terrain tags, or leave it on “Any map”.";
        return;
      }

      var mapObj = null;
      for (var i = 0; i < MAPS.length; i++) {
        if (MAPS[i].name === mapName) {
          mapObj = MAPS[i];
          break;
        }
      }

      var traits = MAP_TRAITS[mapName];

      if (!mapObj && !traits) {
        textEl.textContent = "No metadata found for this map yet. Use the toggles below based on your own sense of the layout.";
        return;
      }

      var difficulty = mapObj ? mapObj.difficulty : "Unknown difficulty";
      var summary = mapName + " • " + difficulty + " map.";

      if (traits && traits.description) {
        summary += " " + traits.description;
      } else {
        summary += " Detailed terrain profile not filled in yet; toggles below are manual.";
      }

      textEl.textContent = summary;

      // Auto-tag toggles only if we have traits
      if (traits) {
        document.getElementById("waterToggle").checked = !!traits.water;
        document.getElementById("multiPathToggle").checked = !!traits.multiPath;
        document.getElementById("losToggle").checked = !!traits.los;
        document.getElementById("shortPathToggle").checked = !!traits.short;

        // Build chip tags
        var tlist = [];
        if (traits.water) tlist.push("Water-heavy");
        if (traits.multiPath) tlist.push("Multi-path / split lanes");
        if (traits.los) tlist.push("Limited line of sight");
        if (traits.short) tlist.push("Short path / punishing leaks");
        if (tlist.length === 0) tlist.push("No major terrain gimmicks");

        tlist.forEach(function (t) {
          var span = document.createElement("span");
          span.className = "map-info-tag";
          span.textContent = t;
          tagsEl.appendChild(span);
        });
      } else {
        // No traits; leave toggles as user set them
        var span = document.createElement("span");
        span.className = "map-info-tag";
        span.textContent = "Manual tags only for this map";
        tagsEl.appendChild(span);
      }
    }

    function recommendStrategies() {
      var selectedHeroes = getSelectedHeroes();
      var mission = document.getElementById("missionSelect").value;
      var mapName = document.getElementById("mapSelect").value;
      var microAllowed = document.getElementById("microToggle").checked;
      var waterMap = document.getElementById("waterToggle").checked;
      var multiPath = document.getElementById("multiPathToggle").checked;
      var los = document.getElementById("losToggle").checked;
      var shortPath = document.getElementById("shortPathToggle").checked;
      var netflixSpecial = document.getElementById("netflixToggle").checked;

      var mapObj = null;
      if (mapName) {
        for (var i = 0; i < MAPS.length; i++) {
          if (MAPS[i].name === mapName) {
            mapObj = MAPS[i];
            break;
          }
        }
      }
      var mapDifficulty = mapObj ? mapObj.difficulty : null;

      var mapTraitsRequested = [];
      if (waterMap) mapTraitsRequested.push("water-heavy");
      if (multiPath) mapTraitsRequested.push("multi-path");
      if (los) mapTraitsRequested.push("limited-los-ok");
      if (shortPath) mapTraitsRequested.push("short-path");
      if (netflixSpecial) mapTraitsRequested.push("netflix-quest");

      var candidates = STRATEGIES.filter(function (s) {
        if (!microAllowed && s.microHeavy) return false;

        if (selectedHeroes.length > 0) {
          if (s.heroes && s.heroes.length > 0) {
            var matchHero = false;
            for (var i = 0; i < s.heroes.length; i++) {
              if (selectedHeroes.indexOf(s.heroes[i]) !== -1) {
                matchHero = true;
                break;
              }
            }
            if (!matchHero) return false;
          }
        }

        if (mission !== "Any") {
          if (!s.missions || (s.missions.indexOf(mission) === -1 && s.missions.indexOf("Any Hard") === -1)) {
            return false;
          }
        }

        return true;
      });

      candidates.forEach(function (s) {
        var score = 0;
        if (s.tier === "S") score += 4;
        else if (s.tier === "A") score += 3;
        else if (s.tier === "B") score += 2;
        else score += 1;

        if (mapDifficulty && s.mapDifficulties) {
          if (s.mapDifficulties.indexOf(mapDifficulty) !== -1) {
            score += 2;
          }
        }

        if (mission !== "Any" && s.missions && s.missions.indexOf(mission) !== -1) {
          score += 1.5;
        }

        if (mapTraitsRequested.length > 0 && s.mapTraits) {
          mapTraitsRequested.forEach(function (t) {
            if (s.mapTraits.indexOf(t) !== -1) score += 1;
          });
        }

        s._score = score;
      });

      candidates.sort(function (a, b) {
        return (b._score || 0) - (a._score || 0);
      });

      var top = candidates.slice(0, 5);
      renderResults(top, mapName, mission, selectedHeroes);
    }

    function renderResults(strategies, mapName, mission, heroes) {
      var container = document.getElementById("results");
      container.innerHTML = "";

      if (!strategies || strategies.length === 0) {
        var div = document.createElement("div");
        div.className = "no-results";
        div.textContent = "No strategies matched your filters. Try relaxing hero selection, map traits, or enabling micro-heavy setups.";
        container.appendChild(div);
        return;
      }

      strategies.forEach(function (s) {
        var card = document.createElement("div");
        card.className = "strategy-card";

        var header = document.createElement("div");
        header.className = "strategy-header";

        var nameEl = document.createElement("div");
        nameEl.className = "strategy-name";
        nameEl.textContent = s.name;

        var tierEl = document.createElement("span");
        tierEl.className = "tier-pill tier-" + s.tier;
        tierEl.textContent = s.tier + " tier";

        header.appendChild(nameEl);
        header.appendChild(tierEl);

        var metaRow = document.createElement("div");
        metaRow.className = "tags";

        var heroTag = document.createElement("span");
        heroTag.className = "tag";
        heroTag.textContent = s.heroes && s.heroes.length > 0 ? "Hero: " + s.heroes.join(", ") : "Hero-flexible";
        metaRow.appendChild(heroTag);

        if (s.mapDifficulties && s.mapDifficulties.length > 0) {
          var diffTag = document.createElement("span");
          diffTag.className = "tag";
          diffTag.textContent = "Maps: " + s.mapDifficulties.join(", ");
          metaRow.appendChild(diffTag);
        }

        if (s.missions && s.missions.length > 0) {
          var missTag = document.createElement("span");
          missTag.className = "tag";
          missTag.textContent = "Modes: " + s.missions.join(", ");
          metaRow.appendChild(missTag);
        }

        if (s.microHeavy) {
          var microTag = document.createElement("span");
          microTag.className = "tag";
          microTag.textContent = "Micro-heavy";
          metaRow.appendChild(microTag);
        }

        var coreTitle = document.createElement("div");
        coreTitle.className = "section-title";
        coreTitle.textContent = "Core towers";

        var coreList = document.createElement("ul");
        (s.coreTowers || []).forEach(function (t) {
          var li = document.createElement("li");
          li.textContent = t;
          coreList.appendChild(li);
        });

        var supportTitle = document.createElement("div");
        supportTitle.className = "section-title";
        supportTitle.textContent = "Support";

        var supportList = document.createElement("ul");
        (s.supportTowers || []).forEach(function (t) {
          var li2 = document.createElement("li");
          li2.textContent = t;
          supportList.appendChild(li2);
        });

        var orderTitle = document.createElement("div");
        orderTitle.className = "section-title";
        orderTitle.textContent = "Rough build order";

        var orderList = document.createElement("ul");
        (s.order || []).forEach(function (step) {
          var li3 = document.createElement("li");
          li3.textContent = step;
          orderList.appendChild(li3);
        });

        var notes = document.createElement("div");
        notes.className = "notes";
        notes.textContent = s.notes || "";

        card.appendChild(header);
        card.appendChild(metaRow);
        card.appendChild(coreTitle);
        card.appendChild(coreList);
        card.appendChild(supportTitle);
        card.appendChild(supportList);
        card.appendChild(orderTitle);
        card.appendChild(orderList);
        card.appendChild(notes);

        container.appendChild(card);
      });
    }

    document.addEventListener("DOMContentLoaded", function () {
      populateMapSelect();
      var btn = document.getElementById("recommendBtn");
      btn.addEventListener("click", recommendStrategies);

      var mapSelect = document.getElementById("mapSelect");
      mapSelect.addEventListener("change", function () {
        updateMapInfo(mapSelect.value);
      });
    });
  </script>
</body>
</html>
